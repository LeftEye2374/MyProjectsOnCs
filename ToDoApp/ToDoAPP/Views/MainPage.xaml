<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TodoApp.Views.MainPage"
             Title="Todo Manager"
             BackgroundColor="{AppThemeBinding Light={Color Parse='#F5F5F5'}, Dark={Color Parse='#1E1E1E'}}">

    <Grid RowDefinitions="Auto,Auto,*" Padding="0">

        <!-- Header Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¾Ð¹ -->
        <Frame Grid.Row="0" Margin="0" CornerRadius="0" BorderColor="Transparent" 
               BackgroundColor="{AppThemeBinding Light={Color Parse='#FFFFFF'}, Dark={Color Parse='#2D2D2D'}}">
            <Grid ColumnDefinitions="*,*" Padding="20,10" RowSpacing="8">
                <VerticalStackLayout Grid.Column="0" Spacing="5">
                    <Label Text="Ð’ÑÐµÐ³Ð¾ Ð·Ð°Ð´Ð°Ñ‡" FontSize="12" TextColor="Gray"/>
                    <Label Text="{Binding TotalCount}" FontSize="24" FontAttributes="Bold"/>
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1" Spacing="5">
                    <Label Text="Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾" FontSize="12" TextColor="Gray"/>
                    <Label Text="{Binding CompletedCount}" FontSize="24" FontAttributes="Bold" TextColor="#4CAF50"/>
                </VerticalStackLayout>
            </Grid>
        </Frame>

        <!-- Ð¤Ð¾Ñ€Ð¼Ð° Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸ -->
        <Frame Grid.Row="1" Margin="10,10" CornerRadius="10"
               BackgroundColor="{AppThemeBinding Light={Color Parse='#FFFFFF'}, Dark={Color Parse='#2D2D2D'}}"
               BorderColor="{AppThemeBinding Light={Color Parse='#E0E0E0'}, Dark={Color Parse='#404040'}}">

            <VerticalStackLayout Spacing="10" Padding="15">
                <Label Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ" FontSize="16" FontAttributes="Bold"/>

                <Entry Placeholder="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸" 
                       Text="{Binding NewTodoTitle}"
                       PlaceholderColor="Gray"
                       BackgroundColor="{AppThemeBinding Light={Color Parse='#F9F9F9'}, Dark={Color Parse='#3D3D3D'}}"/>

                <Editor Placeholder="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)" 
                        Text="{Binding NewTodoDescription}"
                        HeightRequest="80"
                        PlaceholderColor="Gray"
                        BackgroundColor="{AppThemeBinding Light={Color Parse='#F9F9F9'}, Dark={Color Parse='#3D3D3D'}}"/>

                <Button Text="Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ" 
                        Command="{Binding AddTodoCommand}"
                        BackgroundColor="#2196F3"
                        TextColor="White"
                        CornerRadius="8"
                        Padding="15,10"/>
            </VerticalStackLayout>
        </Frame>

        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð·Ð°Ð´Ð°Ñ‡ -->
        <RefreshView Grid.Row="2" 
                     IsRefreshing="{Binding IsRefreshing}"
                     Command="{Binding RefreshCommand}">

            <CollectionView ItemsSource="{Binding TodoItems}"
                           SelectionMode="None">

                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" 
                                        VerticalOptions="Center" 
                                        Spacing="20">
                        <Label Text="ðŸ“­" FontSize="48" HorizontalOptions="Center"/>
                        <Label Text="ÐÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‡" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               TextColor="Gray"/>
                        <Label Text="Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð²Ñ‹ÑˆÐµ" 
                               FontSize="14" 
                               HorizontalOptions="Center"
                               TextColor="Gray"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <SwipeView>
                            <!-- Swipe Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ: ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ -->
                            <SwipeView.RightItems>
                                <SwipeItems SwipeMode="Reveal">
                                    <SwipeItem Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                                              BackgroundColor="#FF5252"
                                              Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteTodoCommand}"
                                              CommandParameter="{Binding .}"/>
                                </SwipeItems>
                            </SwipeView.RightItems>

                            <!-- ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð·Ð°Ð´Ð°Ñ‡Ð¸ -->
                            <Frame Margin="10,5" Padding="15" CornerRadius="10" HasShadow="True"
                                   BackgroundColor="{AppThemeBinding Light={Color Parse='#FFFFFF'}, Dark={Color Parse='#2D2D2D'}}"
                                   BorderColor="{AppThemeBinding Light={Color Parse='#E0E0E0'}, Dark={Color Parse='#404040'}}">

                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                                    <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð·Ð°Ð´Ð°Ñ‡Ðµ -->
                                    <VerticalStackLayout Grid.Column="0" Spacing="5">
                                        <Label Text="{Binding Title}" 
                                              FontSize="16" 
                                              FontAttributes="Bold"
                                              TextColor="{AppThemeBinding Light={Color Parse='#212121'}, Dark={Color Parse='#FFFFFF'}}"/>

                                        <Label Text="{Binding Description}" 
                                              FontSize="13"
                                              TextColor="Gray"
                                              IsVisible="{Binding Description, Converter={StaticResource StringNotNullOrEmptyConverter}}"/>

                                        <Label Text="{Binding CreatedAt, StringFormat='Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾: {0:dd.MM.yyyy HH:mm}'}"
                                              FontSize="11"
                                              TextColor="Gray"
                                              Margin="0,5,0,0"/>

                                        <Label Text="{Binding CompletedAt, StringFormat='Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾: {0:dd.MM.yyyy HH:mm}'}"
                                              FontSize="11"
                                              TextColor="#4CAF50"
                                              IsVisible="{Binding IsCompleted}"/>
                                    </VerticalStackLayout>

                                    <!-- Checkbox -->
                                    <CheckBox Grid.Column="1"
                                             IsChecked="{Binding IsCompleted}"
                                             Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ToggleCompletedCommand}"
                                             CommandParameter="{Binding .}"
                                             VerticalOptions="Center"/>
                                </Grid>
                            </Frame>
                        </SwipeView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>
